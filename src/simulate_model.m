function [model] = simulate_model(model, params)

    for i = 1:params.n - 1

        if rem(i, 1000) == 0 % timer of the simulation
            disp([i, params.n]);
        end
                                
        model = step_neurons(model, params, i);

        [model.neuron_astrozone_activity_spike(:, :, i), ...
            model.neuron_astrozone_activity_OHM(:, :, i), ...
            model.neuron_astrozone_spikes(:, :, i), ...
            model.I_SR_astro(:, :, i)] = ...
            get_neuron_astrozone_activity(model.G(:, i + 1), ...
                                            model.AG(:, i + 1), ...
                                            model.Mask_line, ...
                                            model.I_SR(:, i + 1));
        %
        [model.Ca(:, :, i + 1), ...
            model.H(:, :, 1), ...
            model.IP3(:, :, i + 1), ...
            model.I_WM, ...
            model.Ineuro, ...
            model.Gli_local(:, :, i + 1), ...
            model.Gli_global(:, :, i + 1),...
            model.I_WM_OHM(:,:,i)] = ...
            step_astrocytes(model.neuron_astrozone_activity_spike(:, :, i), ...
                            model.neuron_astrozone_activity_OHM(:, :, i), ...
                            model.neuron_astrozone_spikes, ...
                            model.Ineuro, i, ...
                            model.Ca(:, :, i), ...
                            model.H(:, :, 1), ...
                            model.IP3(:, :, i), ...
                            model.I_WM, ...
                            model.Gli_local(:, :, i), ...
                            model.I_SR_astro(:, :, i), ...
                            model.Gli_global(:, :, i));
        %
        [model.I_WM_line(:, 1), ...
            model.Ca_expand(:, :, i + 1), ...
            model.Gli_local_expand,...
            model.Gli_global_expand] = ...
            expand_astrocytes(model.Ca(:, :, i + 1), ...
                              model.I_WM(:, :, i), ...
                              model.Gli_local(:, :, i + 1),...
                              model.Gli_global(:, :, i + 1));
    end

end
